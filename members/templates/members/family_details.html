{% extends 'members/base.html' %}

{% block content %}
  <div class="container">
      <h1>Familiedetaljer</h1>
      <p>Velkommen til Coding Pirates' medlemssystem. Du ser nu oversigten over de oplysninger vi har registreret om jeres familie. Det er vigtigt du sikrer dig at oplysningerne er korrekte. Din familie er registreret på e-mail-adressen <a class="text-info">{{family.email}}</a>, hvilket også er denne vi sender informationer til dig om tilmeding til hold og aktiviteter.</p>
      <p>For yderligere hjælp med at bruge denne side - se på <a href="http://codingpirates.dk/crmhjaelp/">"Sådan bruger du vores medlemssystem"</a> eller skriv til os på <a href="mailto:kontakt@codingpirates.dk">kontakt@codingpirates.dk</a>.</p>

      <h2>Personer</h2>
      <p>Tryk på <kbd>Opret</kbd>-knapperne, for at tilføje flere personer. Opret gerne begge forældre, så vi kan få fat i jer nemt.</p>
        <section class="card">
          {% if family.person_set.count > 0 %}
          <table class="table table-striped table-responsive" style="display: table; table-layout: fixed;">
            <thead>
              <tr>
                <th class="col-1">Opskrevet</th>
                <th class="col-2">Navn</th>
                <th class="col-3">Adresse</th>
                <th class="col-1">Postnr./by</th>
                <th class="col-2">E-mail</th>
                <th class="col-1">Telefon</th>
                <th class="col-2">Handlinger</th>
              </tr>
            </thead>
            <tbody>
              {% for person in ordered_persons %}
                <tr>
                  {%if person.membertype == 'CH' %}
                  <td><p>{{person.added|date:"d M Y"}}</p>
                  <p class="text-muted">({{person.added|timesince}} siden)</p></td>
                  {%else%}
                  <td></td>
                  {%endif%}

                  <td><p><b>{{person.name}}</b></p>

                  {%if person.membertype == 'PA' %} <p class="text-muted">(Forælder)</p> {%endif%}
                  {%if person.membertype == 'GU' %} <p class="text-muted">(Værge)</p> {%endif%}
                  {%if person.membertype == 'CH' %} <p class="text-muted">(Barn, {{person.age_years}} år)</p> {%endif%}
                  {%if person.membertype == 'NA' %} <p class="text-muted">(Frivillig)</p> {%endif%}

                  </td>

                  <td><p>{{person.address}}</p></td>
                  <td><p>{{person.zipcode}} {{person.city}}</p></td>
                  <td><p>{{person.email}}</p></td>
                  <td><p>{{person.phone}}</p></td>
                  <td><p><a href="{% url 'person_update' person.id %}" class="btn btn-secondary">Redigér</a></p></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
          {% endif %}
        </section>
        <br>
        <a class="btn btn-primary" role="button" href="{% url 'person_add' 'CH' %}">Opret barn</a>
        <a class="btn btn-primary" role="button" href="{% url 'person_add' 'PA' %}">Opret forælder</a>
        <a class="btn btn-primary" role="button" href="{% url 'person_add' 'GU' %}">Opret værge</a>
        <br>
        <br>
        {% if request_parents %}
        <div class="alert alert-warning">
          Opret mindst 1 forælder / værge med kontaktoplysninger, så vi i Coding Pirates nemt kan få fat i jer.
        </div>
        {% endif%}
        {% if need_confirmation %}
        <div class="alert alert-danger">
          Det er længe siden du sidst bekræftede dine oplysninger. <a class="btn btn-success" href="{% url 'confirm_details' %}">Bekræft oplysninger</a>
        </div>
        {% endif %}

      {% if participating or waiting %}
      <h2>Tilmeldte aktiviteter</h2>
        <p>Dette er de aktiviteter jeres børn er tilmeldt. I kan klikke på navnet for hvert arrangement, for at se flere detaljer om hvor og hvornår det foregår. I kan også se deltagerlisten for arrangementet.</p>
        <p>Hvis et arrangement har en rød <kbd>betal</kbd>-knap, er betalingen ikke registreret. Tryk på knappen for at betale.</p>
        
        <section class="card">
          <table class="table table-striped table-responsive">
            <thead>
              <tr>
                <th class="col-sm-3" align="left">Navn</th>
                <th>Aktivitet</th>
                <th class="col-sm-2">Start</th>
                <th class="col-sm-2">Slut</th>
              </tr>
            </thead>
            <tbody>
              {% for participation in participating %}
                <tr>
                  <td>{{participation.member.person.name}}</td>
                  <td><a href="{%url 'activity_view_person' participation.activity.id participation.member.person.id %}">{{participation.activity.name}} - {{participation.activity.department.name}}</a>
                  {% if not participation.paid %}
                  <a class="btn btn-danger" role="button" href="{{participation.get_payment_link}}">Betal</a>
                  {%endif%}

                  </td>
                  <td>{{participation.activity.start_date}}</td>
                  <td>{{participation.activity.end_date}}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </section>
      {% endif %}

      <h2>Invitationer / Åbne aktiviteter</h2>
      <p>Denne liste indeholder invitationer til aktiviteter, hvor der enten er fri tilmelding (først til mølle) eller invitationer til aktiviteter I har stået på venteliste til. I vil modtage en e-mail på e-mail-adressen {{family.email}} når der er aktiviteter, som I kan tilmelde jer.</p>
        {% if invites or waiting_lists or open_activities%}
        <section class="card">
          <table class="table table-striped table-responsive">
            <thead>
              <tr>
                <th align="left">Navn</th>
                <th align="left">Aktivitet</th>
                <th class="text-left" colspan="2">Reaktion</th>
              </tr>
            </thead>
            <tbody>
              {% for invite in invites %}
                <tr>
                  <td>{{invite.person.name}}</td>
                  <td><a href="{%url 'activity_signup' invite.activity.id invite.person.id %}">{{invite.activity.name}} - <h4><b>{{invite.activity.department.name}}</b></h4></a></td>
                  <td><a class="btn btn-success" href="{%url 'activity_signup' invite.activity.id invite.person.id %}">Tilmeld aktivitet</a></td>
                  <td><a class="btn btn-danger" href="{%url 'invitation_decline' family.unique invite.id %}">Afslå</a></td>
                </tr>
              {% endfor %}

              {% for activity in open_activities %}
                  <tr>
                    <td> - </td>
                    <td><a href="{%url 'activity_view_family' activity.id %}">{{activity.name}} - <h4><b>Coding Pirates {{activity.department.name}}</b></h4></a></td>
                      <td>
                      {% for person in activity.persons %}
                    <td><a class="btn btn-success" href="{%url 'activity_signup' activity.id person.id %}">Tilmeld {{ person.firstname }} aktivitet</a></td>
                      {% endfor %}
                      </td>
                    <td></td>
                  </tr>
              {% endfor %}

<<<<<<< HEAD
              </tbody>
          </table>
        </section>
        {% else %}
          <div class="alert alert-primary">
            Der er endnu ikke åbnet for tilmelding til aktiviteter. Vi sender en e-mail til {{family.email}} når vi er klar til at modtage tilmeldinger.
          </div>
        {% endif %}
    </div>
  </div>
{% endblock %}
